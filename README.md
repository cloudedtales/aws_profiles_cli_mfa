# aws_profiles_cli_mfa
Pulls credentials from STS and updates the profile files to easily update config and credentials files if you need to use MFA. 

# description 
<p>If you are using AWS CLI with an IAM account that requires MFA
it's easy enough to query for temporary credentials: <br>
https://aws.amazon.com/premiumsupport/knowledge-center/authenticate-mfa-cli/<br>
You can manually export them to env vars (or try to automate that in bash with the use of e.g. jq to parse JSON response)</p>
However, if you are in the need of updating your .aws/ credentials and config files, 
doing it manually every time your session token will expire is an annoying endeavor. 
This script will use profile you provide (or 'default' if nothing was provided) to: <br>
1. Use sts get-session-token with MFA code You provide to get temporary credentials. <br>
2. Create an [mfa] profile in your config and credentials files if this profile does not exist <br>
3. Update an [mfa] profile in your config and credentials file if this profile does exist. <br>
   

    TESTED ONLY ON WINDOWS AND LINUX only
# how to invoke
Basic example:<br>
```python3 update_credentials_with_mfa.py -s arn:aws:iam::111111111111:mfa/IAM_prog_acc -t 111111``` <br><br>
To get help: ```python3 update_credentials_with_mfa.py -h``` <br><br>
Generally the usage is as follows:<br>
```update_credentials_with_mfa.py [-h] -s SERIAL_NUMBER -t TOKEN_CODE [-d DURATION] [-p AWS_PROFILE]```
<br><br>
Where:<br>
```
  -h, --help            show this help message and exit
  -s SERIAL_NUMBER, --serial-number SERIAL_NUMBER
                        MFA device ARN
  -t TOKEN_CODE, --token-code TOKEN_CODE
                        One time password / token generated by MFA device
  -d DURATION, --duration DURATION [OPTIONAL]
                        Session duration in seconds defaults to 3600 sec (1h)
  -p AWS_PROFILE, --aws-profile AWS_PROFILE [OPTIONAL]
                        Profile to use when pulling credentials. Defaults to 'default'
```

# tips
Please remember it <b>literally</b> creates or updates [mfa] profile in your config files. <br> 
If the profile [mfa] does not exist it will create it. If the profile does exist it will update the profile.<br>
It also means that in order to "use" this credentials you need to use this profile explicitly e.g. by setting env var AWS_PROFILE = mfa<br>
You can still use other profile to get credentials by setting using -p option. E.g. to use profile [someotherprofile]: <br>
```update_credentials_with_mfa.py [-h] -s SERIAL_NUMBER -t TOKEN_CODE [-d DURATION] [-p AWS_PROFILE]```
